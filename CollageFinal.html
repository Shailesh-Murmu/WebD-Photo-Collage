<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/CSS/Navbar.css">
    <link rel="stylesheet" href="/CSS/Boxes.css">
    <link rel="stylesheet" href="/CSS/Collage2.css">
    <link rel="stylesheet" href="/CSS/Collage3.css">
    <link rel="stylesheet" href="/CSS/Collage4.css">
    <link rel="stylesheet" href="/CSS/scroll.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <style>
        
    </style>
</head>
<body>
    <header class="container">
        <nav class="navbar">
            <div class="left">
                <img src="/Images/logo3.png" alt="Image not found" class="logo">
            </div>
            <div class="center" >
                <ul>
                    <li class="items1"><a href="/Html/CollageFinal.html" class="navbtn">Create</a></li>
                    <li class="items1"><a href="/learn" class="navbtn">Learn</a></li>
                    <li class="items1"><a href="/text" class="navbtn">Explore</a></li>
                </ul>
            </div>
            <div class="right">
                <ul>
                    <li class="class"><a href="/authentication/Sign up.html">Sign up</a></li>
                    <li class="class"><a href="/authentication/Sign in.html">Sign in</a></li>
                </ul>
            </div>
        </nav>
    </header>
    <div class="boxes">
        <div class="boxLeft">
            <div class="color icon"><img src="/Images/backgroundicon.png" alt="" class="icon1"></div>
            <div class="images icon"><img src="/Images/1160358.png" alt="" class="icon2"></div>
            <div class="collage icon"><img src="/Images/Collageicon.png" alt="" class="icon3"></div>
        </div>
        <div class="boxCenter1">
            <form action="" class="form">
                <label for="">background:</label>
                <input type="text" name="color" id="color">
                <button class="btn" type="submit">Submit</button>
            </form>
        </div>
        <div class="boxCenter2">
            <div class="insideonce">
                <label for="">Image Name:</label><br>
                <input type="text" id="namebox">
                <label for="" id="extlab"></label>
                <br><br>
                <img alt="" id="myimg" class="i">
                <label for="" id="upprogress"></label><br>

                <button id="selbtn">Select Image</button><br>
                <button id="upbtn">Upload Image</button><br>
                <button id="downbtn">Retrieve Image</button>
            </div>
        </div>
        <div class="boxCenter3">
            Click on Collage:
            <div class="scroll">
                <div class="pic21">pic2lay1</div>
                <div class="pic22">pic2lay2</div>
                <div class="pic31">pic3lay1</div>
                <div class="pic32">pic3lay2</div>
                <div class="pic33">pic3lay3</div>
                <div class="pic34">pic3lay4</div>
                <div class="pic41">pic4lay1</div>
                <div class="pic42">pic4lay2</div>
                <div class="pic43">pic4lay3</div>
                <div class="pic44">pic4lay4</div>
                <div class="pic45">pic4lay5</div>
                <div class="pic46">pic4lay6</div>
                <div class="pic47">pic4lay7</div>
            </div>
        </div>
        <div class="boxRight">
            <div class="inside1">
                
                <div class="collage1a">
                    <div class="box1a box">box1</div>
                    <div class="box2a">box2</div>
                </div>
                <div class="collage1b">
                    <div class="collage1bb">
                        <div class="box1b box">box1</div>
                        <div class="box2b box">box2</div>
                    </div>
                </div> 

                <div class="collage2a">
                    <div class="collage2aa">
                        <div class="box12a box">box1</div>
                        <div class="box12b box">box2</div>
                        <div class="box12c box">box3</div>
                    </div>
                </div>
                <div class="collage2b">
                    <div class="box22a">box1</div>
                    <div class="in2a">
                        <div class="box22b box">box2</div>
                        <div class="box22c box">box3</div>
                    </div>
                </div>
                <div class="collage2c">
                    <div class="box32a box">box1</div>
                    <div class="box32b box">box2</div>
                    <div class="box32c box">box3</div>
                </div>
                <div class="collage2d">
                    <div class="in2b">
                        <div class="box42a box">box1</div>
                        <div class="box42b box">box2</div>
                    </div>
                    <div class="box42c">box3</div>
                </div>
                <div class="collage3a">
                    <div class="in3aa">
                        <div class="box42a box">box1</div>
                        <div class="box42b box">box2</div>
                    </div>
                    <div class="in3ab">
                        <div class="box42c box">box3</div>
                        <div class="box42c box">box3</div>
                    </div>
                </div>
                <div class="collage3b">
                    <div class="collage3bb">
                        <div class="in3ba">
                        <div class="box43a box">box1</div>
                    </div>
                    <div class="in3bb">
                        <div class="box43b box">box2</div>
                        <div class="box43c box">box3</div>
                        <div class="box43d box">box3</div>
                    </div>
                    </div>
                </div>
                <div class="collage3c">
                    <div class="collage3cc">
                        <div class="in3cb">
                            <div class="box44b box">box2</div>
                            <div class="box44c box">box3</div>
                            <div class="box44d box">box3</div>
                        </div>
                        <div class="in3ca">
                            <div class="box44a box">box1</div>
                        </div>
                    </div>
                </div>
                <div class="collage3d">
                    <div class="in3ea">
                        <div class="box45a box">box3</div>
                        <div class="box45b box">box2</div>
                    </div>
                    <div class="in3eb">
                        <div class="box45c box">box3</div>
                        <div class="box45d box">box3</div>
                    </div>
                </div>
                <div class="collage3e">
                    <div class="in3fa">
                        <div class="box46a box">box3</div>
                        <div class="box46b box">box2</div>
                    </div>
                    <div class="in3fb">
                        <div class="box46c box">box3</div>
                        <div class="box46d box">box3</div>
                    </div>
                </div>
                <div class="collage3f">
                    <div class="in3db">
                        <div class="box47b box">box2</div>
                        <div class="box47c box">box3</div>
                        <div class="box47d box">box3</div>
                    </div>
                    <div class="in3da">
                        <div class="box47a box">box1</div>
                    </div>
                </div>
                <div class="collage3g">
                    <div class="in3ea">
                        <div class="box48a box">box1</div>
                    </div>
                    <div class="in3eb">
                        <div class="box48b box">box2</div>
                        <div class="box48c box">box3</div>
                        <div class="box48d box">box3</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyASewByWgwYa1lAeWyn1cP889jYGnbErX4",
          authDomain: "fir-90d67.firebaseapp.com",
          databaseURL: "https://fir-90d67-default-rtdb.firebaseio.com",
          projectId: "fir-90d67",
          storageBucket: "fir-90d67.appspot.com",
          messagingSenderId: "1051701276987",
          appId: "1:1051701276987:web:301b6f992bc024a7cb471e",
          measurementId: "G-HW03CZEQ8K"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-storage.js";

        import { getFirestore, doc, getDoc, setDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-firestore.js";

        const clouddb = getFirestore();




        // variable and reference 
        
        var files = [];
        var reader = new FileReader();

        var namebox = document.getElementById('namebox');
        var extlab = document.getElementById('extlab');
        var myimg = document.getElementById('myimg');
        var proglab = document.getElementById('upprogress');
        var SelBtn = document.getElementById('selbtn');
        var UpBtn = document.getElementById('upbtn');
        var DownBtn = document.getElementById('downbtn');

        var input = document.createElement('input');
        input.type = 'file';

        input.onchange = e =>{
            files = e.target.files;

            var extension = GetFileExt(files[0]);
            var name = GetFileName(files[0]);

            namebox.value = name;
            extlab.innerHTML = extension;


            reader.readAsDataURL(files[0]);
        }

        reader.onload = function(){
            myimg.src = reader.result;
        }

        // selection 

        SelBtn.onclick = function(){
            input.click();
        }

        function GetFileExt(file) {
            var temp = file.name.split('.');
            var ext = temp.slice((temp.length-1),(temp.length));
            return '.' + ext[0];
        }

        function GetFileName(file) {
            var temp = file.name.split('.');
            var fname = temp.slice(0,-1).join('.');
            return fname;
        }

        // upload proces 

        async function UploadProcess(){
            var ImgToUpload = files[0];

            var ImgName = namebox.value + extlab.innerHTML;

            const metaData = {
                contentType: ImgToUpload.type
            }
            

            const storage = getStorage();

            const stroageRef = sRef(storage, "Images/"+ImgName);
            const UploadTask = uploadBytesResumable(stroageRef, ImgToUpload, metaData);

            UploadTask.on('state-changed', (snapshot)=>{
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes)* 100;
                proglab.innerHTML = "Upload "+ progress + "%";
            },
            (error) => {
                alert("error: image not uploaded!")
            },
            ()=>{
                getDownloadURL(UploadTask.snapshot.ref).then((downloadURL)=>{
                    SaveURLtoFirestore(downloadURL)
                    console.log(downloadURL)
                    
                })
            }
            )
        }

        UpBtn.onclick   = UploadProcess;

        // Functions for FIRESTORE DATABASE 

        async function SaveURLtoFirestore(url){
            var name = namebox.value;
            var ext = extlab.innerHTML;
            var ref = doc(clouddb, "ImageLinks/"+name);
            console.log(name,ext)
            await setDoc(ref ,{
            ImageName: (name + ext),
            ImageURL: url
            })      
        }       
    </script>
    <script id="MainScript">
        
    </script>
    <script src="/JAVA/collage.js"></script>
    <script src="/JAVA/background.js"></script>
</body>
</html>